var Controller={init:function(){$("#jp-main").one("click",C.jp.init)},jp:{init:function(){$("#jp-vocab").one("click",C.jp.vocab.init),V.goto_page(".jp.main")},vocab:{init:function(){$("#jp-new-word").one("click",C.jp.vocab.edit.new),V.goto_page(".jp.vocab"),C.jp.vocab.get_JSON()},get_JSON:function(){$.ajax({url:"js/json/jp_words.json",success:function(a){var b=JSON.parse(a);M.jp.vocab.words=b.jpWords,M.jp.vocab.index=b.index,C.jp.vocab.get_localStorage()},error:function(a,b,c){console.log(b),M.jp.vocab.words=[],M.jp.vocab.index=0,C.jp.vocab.get_localStorage()}})},get_localStorage:function(){var a=window.localStorage.getItem("BBBjpWords");if(null!==a&&"[]"!==a){var b=JSON.parse(a),c=M.jp.vocab.words;M.jp.vocab.ls=b,M.jp.vocab.index=c.length?c[c.length-1].i:0;for(var d=0;d<b.length;d++){if(b[d].i>M.jp.vocab.index&&(M.jp.vocab.index=b[d].i),"new"===b[d].f&&c.push(b[d]),"edit"===b[d].f)for(var e=0;e<c.length;e++)c[e].i==b[d].i&&(c[e]=b[d]);if("delete"===b[d].f)for(var e=0;e<c.length;e++)c[e].i==b[d].i&&c.splice(e,1)}}V.jp.vocab.render_list(),setTimeout(C.jp.vocab.bind_list_btns,500)},bind_list_btns:function(){for(var a=$(".edit-btn"),b=$(".del-btn"),c=0;c<a.length;c++)$(a[c]).one("click",function(){var a=$(this).parent().attr("data-index"),b=$(this).parent().attr("data-src");C.jp.vocab.edit.action="edit",C.jp.vocab.edit.src=b,C.jp.vocab.edit.index=a,C.jp.vocab.edit.init()});for(var c=0;c<b.length;c++)$(b[c]).one("click",function(){var a=$(this).parent().attr("data-index"),b=$(this).parent().attr("data-src");C.jp.vocab.edit.action="delete",C.jp.vocab.edit.src=b,C.jp.vocab.edit.index=a,C.jp.vocab.edit.delete.confirm()})},edit:{action:"new",src:"local",index:1,open:!1,init:function(){if(C.jp.vocab.edit.open=!0,$("#jp-new-word").unbind(),V.goto_page(".jp.word-edit"),$(".word-edit .word-input").on("keyup",V.jp.vocab.edit.update_fgInputs),$("#jp-reading").on("click",V.jp.vocab.edit.reading),$("#jp-special-rdg").on("click",V.jp.vocab.edit.special_reading),$("#jp-normal-rdg").on("click",V.jp.vocab.edit.normal_reading),$("#jp-back-word").on("click",V.jp.vocab.edit.back_to_word),$("#jp-cancel-word").on("click",C.jp.vocab.edit.cancel.confirm),$("#jp-save-word").on("click",C.jp.vocab.edit.validate),"edit"===C.jp.vocab.edit.action){for(var a=C.jp.vocab.edit.index,b=M.jp.vocab.words,c=0;c<b.length;c++)if(b[c].i==a){var d=b[c];$(".jp .word-input").val(d.kj.split(",").join("")),$(".jp .word-def").val(d.d);for(var e=$(".jp .word-type option"),f=0;f<e.length;f++)$(e[f]).val()===d.t&&$(e[f]).attr("selected","selected");break}setTimeout(function(){V.jp.vocab.edit.reading(),setTimeout(function(){for(var a=$(".fg-input"),b=d.fg.split(","),c=0;c<a.length;c++)$(a[c]).val(b[c])},500)},1e3)}},new:function(){C.jp.vocab.edit.action="new",C.jp.vocab.edit.src="local",C.jp.vocab.edit.index=M.jp.vocab.index+1,C.jp.vocab.edit.init()},validate:function(){var a=$(".jp .word-input").val(),b=$(".jp .word-def").val(),c=""!==a,d=""!==b;c||alert("you have not entered a word"),d||alert("you have not entered a definition"),c&&d&&C.jp.vocab.edit.save()},save:function(){for(var a=C.jp.vocab.edit.action,b=C.jp.vocab.edit.src,c=M.jp.vocab.ls,d=C.jp.vocab.edit.index,e=$(".jp .word-input").val().split("").toString(),f=$(".jp .word-type").val(),g=$(".jp .word-def").val(),h="",i="",j=0,k=$(".fg-input"),l=[],m=0;m<k.length;m++)l.push($(k[m]).val());var n=l.join(","),o={i:d,kj:e,fg:n,t:f,d:g,cj:h,g:i,l:j};if("new"===a)o.f="new",c.push(o),M.jp.vocab.words.push(o),M.jp.vocab.index=d;else if("edit"===a)if("local"===b){for(var m=0;m<c.length;m++)if(c[m].i==d){o.f=c[m].f,c[m]=o;break}}else o.f="edit",c.push(o);setTimeout(C.jp.vocab.edit.close,100),C.jp.vocab.edit.save_ls()},close:function(){$(".word-edit .word-input, #jp-reading, #jp-special-rdg, #jp-normal-rdg, #jp-back-word, #jp-cancel-word, #jp-save-word").unbind(),V.jp.vocab.edit.reset_form(),C.jp.vocab.init(),C.jp.vocab.edit.open=!1},cancel:{confirm:function(){var a={msgs:["Discard changes?"],btns:["yes","no"],funcs:[C.jp.vocab.edit.cancel.yes,C.jp.vocab.edit.cancel.no]};V.show_overlay(a)},yes:function(){C.jp.vocab.edit.close(),V.hide_overlay()},no:function(){V.hide_overlay()}},delete:{confirm:function(){var a={msgs:["Delete word?"],btns:["yes","no"],funcs:[C.jp.vocab.edit.delete.yes,C.jp.vocab.edit.delete.no]};V.show_overlay(a)},yes:function(){var a=M.jp.vocab.ls;if("local"===C.jp.vocab.edit.src){for(var b=0;b<a.length;b++)if(a[b].i==C.jp.vocab.edit.index){a.splice(b,1);break}}else word={i:C.jp.vocab.edit.index,f:"delete"},a.push(word);C.jp.vocab.edit.save_ls(),V.hide_overlay(),C.jp.vocab.edit.open?C.jp.vocab.edit.close():C.jp.vocab.get_JSON()},no:function(){V.hide_overlay()}},save_ls:function(){var a=M.jp.vocab.ls,b=JSON.stringify(a);window.localStorage.setItem("BBBjpWords",b)}}}}},C=Controller;